import{c as q,u as I,R as Ee,r as M,a as Le,e as xe,s as L,T as x,b as N,d as we,f as O,g as P,h as B,j as p,i as K,B as V,W as R,k as Ie,l as Se,m as re,n as Ce,L as He,N as v,o as g,w as $,M as C,p as D,q as F,t as te,v as ee,P as Q,x as J,y as _,z as Ne,E as U,S as Y,A as Oe,C as ne,F as ie,D as pe,G as he,J as fe,K as Pe,O as Re,Q as je,U as me,V as T,X as _e,Y as $e,Z as De,_ as Fe,$ as Be,a0 as Ke,a1 as Ve}from"./index-CPFxxaxZ.js";import{M as Ue,a as qe,b as Qe,c as We,d as ze}from"./widget-HKDDv3Xj.js";/**
 * @license lucide-react v0.397.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=q("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);/**
 * @license lucide-react v0.397.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=q("PenOff",[["path",{d:"m10 10-6.157 6.162a2 2 0 0 0-.5.833l-1.322 4.36a.5.5 0 0 0 .622.624l4.358-1.323a2 2 0 0 0 .83-.5L14 13.982",key:"bjo8r8"}],["path",{d:"m12.829 7.172 4.359-4.346a1 1 0 1 1 3.986 3.986l-4.353 4.353",key:"16h5ne"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.397.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=q("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.397.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=q("StarOff",[["path",{d:"M8.34 8.34 2 9.27l5 4.87L5.82 21 12 17.77 18.18 21l-.59-3.43",key:"16m0ql"}],["path",{d:"M18.42 12.76 22 9.27l-6.91-1L12 2l-1.44 2.91",key:"1vt8nq"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.397.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=q("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);function et(e){const t=I(e);Ee.useEffect(()=>t,[t])}function tt(e,t){const n=I(e),r=M.useRef(null);return et(()=>{typeof r.current=="number"&&window.clearTimeout(r.current)}),I((...s)=>{typeof r.current=="number"&&window.clearTimeout(r.current),r.current=window.setTimeout(n,t,...s)})}function j(e){const{note:t,isEnabled:n}=e,r=Le();M.useEffect(()=>{n&&t&&r.setQueryData([be,t.id],t)},[r,n,t==null?void 0:t.id])}async function nt(e){const{id:t,json:n}=e,r=xe(n),s=await L.from(x.NOTES).update({json:n,name:r,updatedAt:new Date}).eq("id",t).select("*").single();if(s.error)throw s.error;return s.data}const st="update-note";function rt(){return N({mutationKey:[st],mutationFn:nt})}async function it(e){const{id:t}=e,n=await L.from(x.NOTES).update({isEditable:!0}).eq("id",t).select("*").single();if(n.error)throw n.error;return n.data}const ot="make-note-editable";function at(){return N({mutationKey:[ot],mutationFn:it})}async function lt(e){const{id:t}=e,n=await L.from(x.NOTES).update({isEditable:!1}).eq("id",t).select("*").single();if(n.error)throw n.error;return n.data}const dt="make-note-uneditable";function ut(){return N({mutationKey:[dt],mutationFn:lt})}async function ct(e){const{id:t}=e,n=await L.from(x.NOTES).update({isFavorite:!0}).eq("id",t).select("*").single();if(n.error)throw n.error;return n.data}const pt="move-note-to-favorites";function ht(){return N({mutationKey:[pt],mutationFn:ct})}async function ft(e){const{id:t}=e,n=await L.from(x.NOTES).update({isFavorite:!1}).eq("id",t).select("*").single();if(n.error)throw n.error;return n.data}const mt="remove-note-from-favorites";function gt(){return N({mutationKey:[mt],mutationFn:ft})}async function ge(e){const{id:t}=e,n=await L.from(x.NOTES).update({isDeleted:!0,deletedAt:new Date}).eq("id",t).select("*").single();if(n.error)throw n.error;const r=await L.from(x.NOTES).select("*").eq("parentId",t);if(r.error)throw r.error;return await Promise.all(r.data.map(s=>ge({id:s.id}))),n.data}const yt="move-note-to-trash";function bt(){return N({mutationKey:[yt],mutationFn:ge})}async function ye(e){const{id:t,parentId:n}=e,r=await L.from(x.NOTES).select("*").eq("id",n).single(),s=r.data&&!r.data.isDeleted?n:null,i=await L.from(x.NOTES).update({isDeleted:!1,parentId:s,deletedAt:null}).eq("id",t).select("*").single();if(i.error)throw i.error;const o=await L.from(x.NOTES).select("*").eq("parentId",t);if(o.error)throw o.error;return await Promise.all(o.data.map(a=>ye({parentId:a.parentId,id:a.id}))),i.data}const Tt="remove-note-from-trash";function Mt(){return N({mutationKey:[Tt],mutationFn:ye})}async function kt(e){const{id:t}=e,n=await L.from(x.NOTES).select("*").eq("id",t).single();if(n.error)throw n.error;return n.data}const be="select-note";function At(e,t=!0){return we({queryKey:[be,e.id],queryFn:()=>kt(e),enabled:t&&!!e.id})}const vt=e=>{var y;const{noteId:t,noteParentId:n,startIcon:r=Je,variant:s="outlined",justify:i="center",loading:o=!1,fullWidth:a=!1,onClick:d,title:u="Set editable","aria-label":h="Set editable",...c}=e,l=at(),f=O(l.isError);P({parentId:n,isEnabled:l.isSuccess}),j({note:l.data,isEnabled:l.isSuccess}),B({isEnabled:l.isSuccess});const m=I(A=>{d==null||d(A),l.mutate({id:t})});return p.jsxs(M.Fragment,{children:[p.jsx(K,{title:u,children:p.jsx(V,{startIcon:r,variant:s,justify:i,loading:o||l.isPending,fullWidth:a,onClick:m,"aria-label":h,...c})}),p.jsx(R,{title:"Something went wrong",text:((y=l.error)==null?void 0:y.message)??"",opened:f.isVisible,onClose:f.hide})]})},Et=M.memo(vt),Lt=e=>{var y;const{noteId:t,noteParentId:n,startIcon:r=Ge,variant:s="outlined",justify:i="center",loading:o=!1,fullWidth:a=!1,onClick:d,title:u="Set uneditable","aria-label":h="Set uneditable",...c}=e,l=ut(),f=O(l.isError);P({parentId:n,isEnabled:l.isSuccess}),j({note:l.data,isEnabled:l.isSuccess}),B({isEnabled:l.isSuccess});const m=I(A=>{d==null||d(A),l.mutate({id:t})});return p.jsxs(M.Fragment,{children:[p.jsx(K,{title:u,children:p.jsx(V,{startIcon:r,variant:s,justify:i,loading:o||l.isPending,fullWidth:a,onClick:m,"aria-label":h,...c})}),p.jsx(R,{title:"Something went wrong",text:((y=l.error)==null?void 0:y.message)??"",opened:f.isVisible,onClose:f.hide})]})},xt=M.memo(Lt),wt=e=>{var y;const{noteId:t,noteParentId:n,startIcon:r=Ze,variant:s="outlined",justify:i="center",loading:o=!1,fullWidth:a=!1,onClick:d,title:u="Move note to favorites","aria-label":h="Move note to favorites",...c}=e,l=ht(),f=O(l.isError);P({parentId:n,isEnabled:l.isSuccess}),j({note:l.data,isEnabled:l.isSuccess}),B({isEnabled:l.isSuccess});const m=I(A=>{d==null||d(A),l.mutate({id:t})});return p.jsxs(M.Fragment,{children:[p.jsx(K,{title:u,children:p.jsx(V,{startIcon:r,variant:s,justify:i,loading:o||l.isPending,fullWidth:a,onClick:m,"aria-label":h,...c})}),p.jsx(R,{title:"Something went wrong",text:((y=l.error)==null?void 0:y.message)??"",opened:f.isVisible,onClose:f.hide})]})},It=M.memo(wt),St=e=>{var y;const{noteId:t,noteParentId:n,startIcon:r=Xe,variant:s="outlined",justify:i="center",loading:o=!1,fullWidth:a=!1,onClick:d,title:u="Remove note from favorites","aria-label":h="Remove note from favorites",...c}=e,l=gt(),f=O(l.isError);P({parentId:n,isEnabled:l.isSuccess}),j({note:l.data,isEnabled:l.isSuccess}),B({isEnabled:l.isSuccess});const m=I(A=>{d==null||d(A),l.mutate({id:t})});return p.jsxs(M.Fragment,{children:[p.jsx(K,{title:u,children:p.jsx(V,{startIcon:r,variant:s,justify:i,loading:o||l.isPending,fullWidth:a,onClick:m,"aria-label":h,...c})}),p.jsx(R,{title:"Something went wrong",text:((y=l.error)==null?void 0:y.message)??"",opened:f.isVisible,onClose:f.hide})]})},Ct=M.memo(St),Ht=e=>{var y;const{noteId:t,noteParentId:n,startIcon:r=Ie,variant:s="outlined",justify:i="center",loading:o=!1,fullWidth:a=!1,onClick:d,title:u="Move note to trash","aria-label":h="Move note to trash",...c}=e,l=bt(),f=O(l.isError);P({parentId:n,isEnabled:l.isSuccess}),j({note:l.data,isEnabled:l.isSuccess}),B({isEnabled:l.isSuccess});const m=I(A=>{d==null||d(A),l.mutate({id:t})});return p.jsxs(M.Fragment,{children:[p.jsx(K,{title:u,children:p.jsx(V,{startIcon:r,variant:s,justify:i,loading:o||l.isPending,fullWidth:a,onClick:m,"aria-label":h,...c})}),p.jsx(R,{title:"Something went wrong",text:((y=l.error)==null?void 0:y.message)??"",opened:f.isVisible,onClose:f.hide})]})},Nt=M.memo(Ht),Ot=e=>{var y,A;const{noteId:t,noteParentId:n,startIcon:r=Ye,variant:s="outlined",justify:i="center",loading:o=!1,fullWidth:a=!1,onClick:d,title:u="Remove note from trash","aria-label":h="Remove note from trash",...c}=e,l=Mt(),f=O(l.isError);P({parentId:(y=l.data)==null?void 0:y.parentId,isEnabled:l.isSuccess}),j({note:l.data,isEnabled:l.isSuccess}),B({isEnabled:l.isSuccess});const m=I(ve=>{d==null||d(ve),l.mutate({id:t,parentId:n})});return p.jsxs(M.Fragment,{children:[p.jsx(K,{title:u,children:p.jsx(V,{startIcon:r,variant:s,justify:i,loading:o||l.isPending,fullWidth:a,onClick:m,"aria-label":h,...c})}),p.jsx(R,{title:"Something went wrong",text:((A=l.error)==null?void 0:A.message)??"",opened:f.isVisible,onClose:f.hide})]})},Pt=M.memo(Ot),Rt=e=>{const{id:t,parentId:n,isFavorite:r,isEditable:s,isDeleted:i}=e;return p.jsxs(Se,{children:[p.jsxs(re,{children:[p.jsx(Ce,{}),p.jsx(He,{})]}),p.jsxs(re,{children:[!i&&p.jsxs(M.Fragment,{children:[r?p.jsx(Ct,{noteId:t,noteParentId:n}):p.jsx(It,{noteId:t,noteParentId:n}),s?p.jsx(xt,{noteId:t,noteParentId:n}):p.jsx(Et,{noteId:t,noteParentId:n})]}),i?p.jsx(Pt,{noteId:t,noteParentId:n}):p.jsx(Nt,{noteId:t,noteParentId:n})]})]})},jt=M.memo(Rt),_t=/^\s*>\s$/,$t=v.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:e}){return["blockquote",g(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[$({find:_t,type:this.type})]}}),Dt=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,Ft=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,Bt=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,Kt=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Vt=C.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>e.style.fontWeight!=="normal"&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return["strong",g(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[D({find:Dt,type:this.type}),D({find:Bt,type:this.type})]},addPasteRules(){return[F({find:Ft,type:this.type}),F({find:Kt,type:this.type})]}}),Ut=v.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",g(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),oe=C.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:e=>e.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["span",g(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{const n=te(e,this.type);return Object.entries(n).some(([,s])=>!!s)?!0:t.unsetMark(this.name)}}}}),ae=/^\s*([-+*])\s$/,qt=v.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:e}){return["ul",g(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Ut.name,this.editor.getAttributes(oe.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=$({find:ae,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=$({find:ae,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(oe.name),editor:this.editor})),[e]}}),Qt=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))$/,Wt=/(?:^|\s)(`(?!\s+`)((?:[^`]+))`(?!\s+`))/g,zt=C.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:e}){return["code",g(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[D({find:Qt,type:this.type})]},addPasteRules(){return[F({find:Wt,type:this.type})]}}),Yt=/^```([a-z]+)?[\s\n]$/,Gt=/^~~~([a-z]+)?[\s\n]$/,Jt=v.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options,i=[...((t=e.firstElementChild)===null||t===void 0?void 0:t.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:e,HTMLAttributes:t}){return["pre",g(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=t.pos===1;return!e||t.parent.type.name!==this.name?!1:n||!t.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:e.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:r}=t,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0||r.nodeAt(a)?!1:e.commands.exitCode()}}},addInputRules(){return[ee({find:Yt,type:this.type,getAttributes:e=>({language:e[1]})}),ee({find:Gt,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new Q({key:new J("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData||this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),r=t.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:o}=e.state;return e.state.selection.from===e.state.doc.nodeSize-(1+e.state.selection.$to.depth*2)?o.insert(e.state.selection.from-1,this.type.create({language:i})):o.replaceSelectionWith(this.type.create({language:i})),o.setSelection(_.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.insertText(n.replace(/\r\n?/g,`
`)),o.setMeta("paste",!0),e.dispatch(o),!0}}})]}}),Xt=v.create({name:"doc",topNode:!0,content:"block+"});function Zt(e={}){return new Q({view(t){return new en(t,e)}})}class en{constructor(t,n){var r;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return t.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:t,handler:n})=>this.editorView.dom.removeEventListener(t,n))}update(t,n){this.cursorPos!=null&&n.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,t==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent,r;if(n){let a=t.nodeBefore,d=t.nodeAfter;if(a||d){let u=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(u){let h=u.getBoundingClientRect(),c=a?h.bottom:h.top;a&&d&&(c=(c+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),r={left:h.left,right:h.right,top:c-this.width/2,bottom:c+this.width/2}}}}if(!r){let a=this.editorView.coordsAtPos(this.cursorPos);r={left:a.left-this.width/2,right:a.left+this.width/2,top:a.top,bottom:a.bottom}}let s=this.editorView.dom.offsetParent;this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let i,o;if(!s||s==document.body&&getComputedStyle(s).position=="static")i=-pageXOffset,o=-pageYOffset;else{let a=s.getBoundingClientRect();i=a.left-s.scrollLeft,o=a.top-s.scrollTop}this.element.style.left=r.left-i+"px",this.element.style.top=r.top-o+"px",this.element.style.width=r.right-r.left+"px",this.element.style.height=r.bottom-r.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),t)}dragover(t){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,t):s;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=Ne(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){(t.target==this.editorView.dom||!this.editorView.dom.contains(t.relatedTarget))&&this.setCursor(null)}}const tn=U.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[Zt(this.options)]}});class b extends Y{constructor(t){super(t,t)}map(t,n){let r=t.resolve(n.map(this.head));return b.valid(r)?new b(r):Y.near(r)}content(){return pe.empty}eq(t){return t instanceof b&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new b(t.resolve(n.pos))}getBookmark(){return new se(this.anchor)}static valid(t){let n=t.parent;if(n.isTextblock||!nn(t)||!sn(t))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(t.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(t,n,r=!1){e:for(;;){if(!r&&b.valid(t))return t;let s=t.pos,i=null;for(let o=t.depth;;o--){let a=t.node(o);if(n>0?t.indexAfter(o)<a.childCount:t.index(o)>0){i=a.child(n>0?t.indexAfter(o):t.index(o)-1);break}else if(o==0)return null;s+=n;let d=t.doc.resolve(s);if(b.valid(d))return d}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!ne.isSelectable(i)){t=t.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=o,s+=n;let a=t.doc.resolve(s);if(b.valid(a))return a}return null}}}b.prototype.visible=!1;b.findFrom=b.findGapCursorFrom;Y.jsonID("gapcursor",b);class se{constructor(t){this.pos=t}map(t){return new se(t.map(this.pos))}resolve(t){let n=t.resolve(this.pos);return b.valid(n)?new b(n):Y.near(n)}}function nn(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),r=e.node(t);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function sn(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),r=e.node(t);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||s.isAtom||s.type.spec.isolating)return!0;if(s.inlineContent)return!1}}return!0}function rn(){return new Q({props:{decorations:dn,createSelectionBetween(e,t,n){return t.pos==n.pos&&b.valid(n)?new b(n):null},handleClick:an,handleKeyDown:on,handleDOMEvents:{beforeinput:ln}}})}const on=Oe({ArrowLeft:W("horiz",-1),ArrowRight:W("horiz",1),ArrowUp:W("vert",-1),ArrowDown:W("vert",1)});function W(e,t){const n=e=="vert"?t>0?"down":"up":t>0?"right":"left";return function(r,s,i){let o=r.selection,a=t>0?o.$to:o.$from,d=o.empty;if(o instanceof _){if(!i.endOfTextblock(n)||a.depth==0)return!1;d=!1,a=r.doc.resolve(t>0?a.after():a.before())}let u=b.findGapCursorFrom(a,t,d);return u?(s&&s(r.tr.setSelection(new b(u))),!0):!1}}function an(e,t,n){if(!e||!e.editable)return!1;let r=e.state.doc.resolve(t);if(!b.valid(r))return!1;let s=e.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&ne.isSelectable(e.state.doc.nodeAt(s.inside))?!1:(e.dispatch(e.state.tr.setSelection(new b(r))),!0)}function ln(e,t){if(t.inputType!="insertCompositionText"||!(e.state.selection instanceof b))return!1;let{$from:n}=e.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!r)return!1;let s=ie.empty;for(let o=r.length-1;o>=0;o--)s=ie.from(r[o].createAndFill(null,s));let i=e.state.tr.replace(n.pos,n.pos,new pe(s,0,0));return i.setSelection(_.near(i.doc.resolve(n.pos+1))),e.dispatch(i),!1}function dn(e){if(!(e.selection instanceof b))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",he.create(e.doc,[fe.widget(e.selection.head,t,{key:"gapcursor"})])}const un=U.create({name:"gapCursor",addProseMirrorPlugins(){return[rn()]},extendNodeSchema(e){var t;const n={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:(t=Pe(Re(e,"allowGapCursor",n)))!==null&&t!==void 0?t:null}}}),cn=v.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:e}){return["br",g(this.options.HTMLAttributes,e)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:r})=>e.first([()=>e.exitCode(),()=>e.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,d=i||s.$to.parentOffset&&s.$from.marks();return t().insertContent({type:this.name}).command(({tr:u,dispatch:h})=>{if(h&&d&&o){const c=d.filter(l=>a.includes(l.type.name));u.ensureMarks(c)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),pn=v.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(e=>({tag:`h${e}`,attrs:{level:e}}))},renderHTML({node:e,HTMLAttributes:t}){return[`h${this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]}`,g(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.setNode(this.name,e):!1,toggleHeading:e=>({commands:t})=>this.options.levels.includes(e.level)?t.toggleNode(this.name,"paragraph",e):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})}),{})},addInputRules(){return this.options.levels.map(e=>ee({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}}))}});var G=200,k=function(){};k.prototype.append=function(t){return t.length?(t=k.from(t),!this.length&&t||t.length<G&&this.leafAppend(t)||this.length<G&&t.leafPrepend(this)||this.appendInner(t)):this};k.prototype.prepend=function(t){return t.length?k.from(t).append(this):this};k.prototype.appendInner=function(t){return new hn(this,t)};k.prototype.slice=function(t,n){return t===void 0&&(t=0),n===void 0&&(n=this.length),t>=n?k.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,n))};k.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)};k.prototype.forEach=function(t,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(t,n,r,0):this.forEachInvertedInner(t,n,r,0)};k.prototype.map=function(t,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(t(i,o))},n,r),s};k.from=function(t){return t instanceof k?t:t&&t.length?new Te(t):k.empty};var Te=function(e){function t(r){e.call(this),this.values=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new t(this.values.slice(s,i))},t.prototype.getInner=function(s){return this.values[s]},t.prototype.forEachInner=function(s,i,o,a){for(var d=i;d<o;d++)if(s(this.values[d],a+d)===!1)return!1},t.prototype.forEachInvertedInner=function(s,i,o,a){for(var d=i-1;d>=o;d--)if(s(this.values[d],a+d)===!1)return!1},t.prototype.leafAppend=function(s){if(this.length+s.length<=G)return new t(this.values.concat(s.flatten()))},t.prototype.leafPrepend=function(s){if(this.length+s.length<=G)return new t(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(k);k.empty=new Te([]);var hn=function(e){function t(n,r){e.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},t.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},t.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},t.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},t.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new t(this.left,s)},t.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new t(s,this.right)},t.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new t(this.left,new t(this.right,r)):new t(this,r)},t}(k);const fn=500;class E{constructor(t,n){this.items=t,this.eventCount=n}popEvent(t,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=t.tr,a,d,u=[],h=[];return this.items.forEach((c,l)=>{if(!c.step){s||(s=this.remapping(r,l+1),i=s.maps.length),i--,h.push(c);return}if(s){h.push(new w(c.map));let f=c.step.map(s.slice(i)),m;f&&o.maybeStep(f).doc&&(m=o.mapping.maps[o.mapping.maps.length-1],u.push(new w(m,void 0,void 0,u.length+h.length))),i--,m&&s.appendMap(m,i)}else o.maybeStep(c.step);if(c.selection)return a=s?c.selection.map(s.slice(i)):c.selection,d=new E(this.items.slice(0,r).append(h.reverse().concat(u)),this.eventCount-1),!1},this.items.length,0),{remaining:d,transform:o,selection:a}}addTransform(t,n,r,s){let i=[],o=this.eventCount,a=this.items,d=!s&&a.length?a.get(a.length-1):null;for(let h=0;h<t.steps.length;h++){let c=t.steps[h].invert(t.docs[h]),l=new w(t.mapping.maps[h],c,n),f;(f=d&&d.merge(l))&&(l=f,h?i.pop():a=a.slice(0,a.length-1)),i.push(l),n&&(o++,n=void 0),s||(d=l)}let u=o-r.depth;return u>gn&&(a=mn(a,u),o-=u),new E(a.append(i),o)}remapping(t,n){let r=new je;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=t?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},t,n),r}addMaps(t){return this.eventCount==0?this:new E(this.items.append(t.map(n=>new w(n))),this.eventCount)}rebased(t,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=t.mapping,o=t.steps.length,a=this.eventCount;this.items.forEach(l=>{l.selection&&a--},s);let d=n;this.items.forEach(l=>{let f=i.getMirror(--d);if(f==null)return;o=Math.min(o,f);let m=i.maps[f];if(l.step){let y=t.steps[f].invert(t.docs[f]),A=l.selection&&l.selection.map(i.slice(d+1,f));A&&a++,r.push(new w(m,y,A))}else r.push(new w(m))},s);let u=[];for(let l=n;l<o;l++)u.push(new w(i.maps[l]));let h=this.items.slice(0,s).append(u).append(r),c=new E(h,a);return c.emptyItemCount()>fn&&(c=c.compress(this.items.length-r.length)),c}emptyItemCount(){let t=0;return this.items.forEach(n=>{n.step||t++}),t}compress(t=this.items.length){let n=this.remapping(0,t),r=n.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=t)s.push(o),o.selection&&i++;else if(o.step){let d=o.step.map(n.slice(r)),u=d&&d.getMap();if(r--,u&&n.appendMap(u,r),d){let h=o.selection&&o.selection.map(n.slice(r));h&&i++;let c=new w(u.invert(),d,h),l,f=s.length-1;(l=s.length&&s[f].merge(c))?s[f]=l:s.push(c)}}else o.map&&r--},this.items.length,0),new E(k.from(s.reverse()),i)}}E.empty=new E(k.empty,0);function mn(e,t){let n;return e.forEach((r,s)=>{if(r.selection&&t--==0)return n=s,!1}),e.slice(n)}class w{constructor(t,n,r,s){this.map=t,this.step=n,this.selection=r,this.mirrorOffset=s}merge(t){if(this.step&&t.step&&!t.selection){let n=t.step.merge(this.step);if(n)return new w(n.getMap().invert(),n,this.selection)}}}class S{constructor(t,n,r,s,i){this.done=t,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const gn=20;function yn(e,t,n,r){let s=n.getMeta(H),i;if(s)return s.historyState;n.getMeta(Mn)&&(e=new S(e.done,e.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return e;if(o&&o.getMeta(H))return o.getMeta(H).redo?new S(e.done.addTransform(n,void 0,r,z(t)),e.undone,le(n.mapping.maps[n.steps.length-1]),e.prevTime,e.prevComposition):new S(e.done,e.undone.addTransform(n,void 0,r,z(t)),null,e.prevTime,e.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),d=e.prevTime==0||!o&&e.prevComposition!=a&&(e.prevTime<(n.time||0)-r.newGroupDelay||!bn(n,e.prevRanges)),u=o?X(e.prevRanges,n.mapping):le(n.mapping.maps[n.steps.length-1]);return new S(e.done.addTransform(n,d?t.selection.getBookmark():void 0,r,z(t)),E.empty,u,n.time,a??e.prevComposition)}else return(i=n.getMeta("rebased"))?new S(e.done.rebased(n,i),e.undone.rebased(n,i),X(e.prevRanges,n.mapping),e.prevTime,e.prevComposition):new S(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),X(e.prevRanges,n.mapping),e.prevTime,e.prevComposition)}function bn(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<t.length;i+=2)r<=t[i+1]&&s>=t[i]&&(n=!0)}),n}function le(e){let t=[];return e.forEach((n,r,s,i)=>t.push(s,i)),t}function X(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let s=t.map(e[r],1),i=t.map(e[r+1],-1);s<=i&&n.push(s,i)}return n}function Tn(e,t,n){let r=z(t),s=H.get(t).spec.config,i=(n?e.undone:e.done).popEvent(t,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?e.done:e.undone).addTransform(i.transform,t.selection.getBookmark(),s,r),d=new S(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(H,{redo:n,historyState:d})}let Z=!1,de=null;function z(e){let t=e.plugins;if(de!=t){Z=!1,de=t;for(let n=0;n<t.length;n++)if(t[n].spec.historyPreserveItems){Z=!0;break}}return Z}const H=new J("history"),Mn=new J("closeHistory");function kn(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new Q({key:H,state:{init(){return new S(E.empty,E.empty,null,0,-1)},apply(t,n,r){return yn(n,r,t,e)}},config:e,props:{handleDOMEvents:{beforeinput(t,n){let r=n.inputType,s=r=="historyUndo"?ke:r=="historyRedo"?Ae:null;return s?(n.preventDefault(),s(t.state,t.dispatch)):!1}}}})}function Me(e,t){return(n,r)=>{let s=H.getState(n);if(!s||(e?s.undone:s.done).eventCount==0)return!1;if(r){let i=Tn(s,n,e);i&&r(t?i.scrollIntoView():i)}return!0}}const ke=Me(!1,!0),Ae=Me(!0,!0),An=U.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>ke(e,t),redo:()=>({state:e,dispatch:t})=>Ae(e,t)}},addProseMirrorPlugins(){return[kn(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),vn=v.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:e}){return["hr",g(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e,state:t})=>{const{$to:n}=t.selection,r=e();return n.parentOffset===0?r.insertContentAt(Math.max(n.pos-2,0),{type:this.name}):r.insertContent({type:this.name}),r.command(({tr:s,dispatch:i})=>{var o;if(i){const{$to:a}=s.selection,d=a.end();if(a.nodeAfter)a.nodeAfter.isTextblock?s.setSelection(_.create(s.doc,a.pos+1)):a.nodeAfter.isBlock?s.setSelection(ne.create(s.doc,a.pos)):s.setSelection(_.create(s.doc,a.pos));else{const u=(o=a.parent.type.contentMatch.defaultType)===null||o===void 0?void 0:o.create();u&&(s.insert(d,u),s.setSelection(_.create(s.doc,d+1)))}s.scrollIntoView()}return!0}).run()}}},addInputRules(){return[me({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),En=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Ln=v.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:e}){return["img",g(this.options.HTMLAttributes,e)]},addCommands(){return{setImage:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e})}},addInputRules(){return[me({find:En,type:this.type,getAttributes:e=>{const[,,t,n,r]=e;return{src:n,alt:t,title:r}}})]}}),xn=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,wn=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,In=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,Sn=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,Cn=C.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>e.style.fontStyle!=="normal"&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",g(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[D({find:xn,type:this.type}),D({find:In,type:this.type})]},addPasteRules(){return[F({find:wn,type:this.type}),F({find:Sn,type:this.type})]}}),Hn=v.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",g(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Nn=v.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",g(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),ue=C.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:e=>e.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["span",g(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{const n=te(e,this.type);return Object.entries(n).some(([,s])=>!!s)?!0:t.unsetMark(this.name)}}}}),ce=/^(\d+)\.\s$/,On=v.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return t===1?["ol",g(this.options.HTMLAttributes,n),0]:["ol",g(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Nn.name,this.editor.getAttributes(ue.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=$({find:ce,type:this.type,getAttributes:t=>({start:+t[1]}),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(e=$({find:ce,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:t=>({start:+t[1],...this.editor.getAttributes(ue.name)}),joinPredicate:(t,n)=>n.childCount+n.attrs.start===+t[1],editor:this.editor})),[e]}}),Pn=v.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:e}){return["p",g(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Rn=U.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,considerAnyAsEmpty:!1,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new Q({key:new J("placeholder"),props:{decorations:({doc:e,selection:t})=>{var n;const r=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:s}=t,i=[];if(!r)return null;const{firstChild:o}=e.content,a=o&&o.type.isLeaf,d=o&&o.isAtom,u=this.options.considerAnyAsEmpty?!0:o&&o.type.name===((n=e.type.contentMatch.defaultType)===null||n===void 0?void 0:n.name),h=e.content.childCount<=1&&o&&u&&o.nodeSize<=2&&(!a||!d);return e.descendants((c,l)=>{const f=s>=l&&s<=l+c.nodeSize,m=!c.isLeaf&&!c.childCount;if((f||!this.options.showOnlyCurrent)&&m){const y=[this.options.emptyNodeClass];h&&y.push(this.options.emptyEditorClass);const A=fe.node(l,l+c.nodeSize,{class:y.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:c,pos:l,hasAnchor:f}):this.options.placeholder});i.push(A)}return this.options.includeChildren}),he.create(e,i)}}})]}}),jn=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,_n=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,$n=C.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["s",g(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[D({find:jn,type:this.type})]},addPasteRules(){return[F({find:_n,type:this.type})]}}),Dn=/^\s*(\[([( |x])?\])\s$/,Fn=v.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList"}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:e=>e.getAttribute("data-checked")==="true",renderHTML:e=>({"data-checked":e.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:e,HTMLAttributes:t}){return["li",g(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:e.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const e={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...e,Tab:()=>this.editor.commands.sinkListItem(this.name)}:e},addNodeView(){return({node:e,HTMLAttributes:t,getPos:n,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),d=document.createElement("div");return i.contentEditable="false",a.type="checkbox",a.addEventListener("change",u=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:h}=u.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:c})=>{const l=n(),f=c.doc.nodeAt(l);return c.setNodeMarkup(l,void 0,{...f==null?void 0:f.attrs,checked:h}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(e,h)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,h])=>{s.setAttribute(u,h)}),s.dataset.checked=e.attrs.checked,e.attrs.checked&&a.setAttribute("checked","checked"),i.append(a,o),s.append(i,d),Object.entries(t).forEach(([u,h])=>{s.setAttribute(u,h)}),{dom:s,contentDOM:d,update:u=>u.type!==this.type?!1:(s.dataset.checked=u.attrs.checked,u.attrs.checked?a.setAttribute("checked","checked"):a.removeAttribute("checked"),!0)}}},addInputRules(){return[$({find:Dn,type:this.type,getAttributes:e=>({checked:e[e.length-1]==="x"})})]}}),Bn=v.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:e}){return["ul",g(this.options.HTMLAttributes,e,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),Kn=v.create({name:"text",group:"inline"}),Vn=U.create({name:"textAlign",addOptions(){return{types:[],alignments:["left","center","right","justify"],defaultAlignment:"left"}},addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:e=>e.style.textAlign||this.options.defaultAlignment,renderHTML:e=>e.textAlign===this.options.defaultAlignment?{}:{style:`text-align: ${e.textAlign}`}}}}]},addCommands(){return{setTextAlign:e=>({commands:t})=>this.options.alignments.includes(e)?this.options.types.map(n=>t.updateAttributes(n,{textAlign:e})).every(n=>n):!1,unsetTextAlign:()=>({commands:e})=>this.options.types.map(t=>e.resetAttributes(t,"textAlign")).every(t=>t)}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),Un=C.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:e=>e.hasAttribute("style")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["span",g(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{const n=te(e,this.type);return Object.entries(n).some(([,s])=>!!s)?!0:t.unsetMark(this.name)}}}}),qn=e=>T({find:/--$/,replace:e??"—"}),Qn=e=>T({find:/\.\.\.$/,replace:e??"…"}),Wn=e=>T({find:/(?:^|[\s{[(<'"\u2018\u201C])(")$/,replace:e??"“"}),zn=e=>T({find:/"$/,replace:e??"”"}),Yn=e=>T({find:/(?:^|[\s{[(<'"\u2018\u201C])(')$/,replace:e??"‘"}),Gn=e=>T({find:/'$/,replace:e??"’"}),Jn=e=>T({find:/<-$/,replace:e??"←"}),Xn=e=>T({find:/->$/,replace:e??"→"}),Zn=e=>T({find:/\(c\)$/,replace:e??"©"}),es=e=>T({find:/\(tm\)$/,replace:e??"™"}),ts=e=>T({find:/\(sm\)$/,replace:e??"℠"}),ns=e=>T({find:/\(r\)$/,replace:e??"®"}),ss=e=>T({find:/(?:^|\s)(1\/2)\s$/,replace:e??"½"}),rs=e=>T({find:/\+\/-$/,replace:e??"±"}),is=e=>T({find:/!=$/,replace:e??"≠"}),os=e=>T({find:/<<$/,replace:e??"«"}),as=e=>T({find:/>>$/,replace:e??"»"}),ls=e=>T({find:/\d+\s?([*x])\s?\d+$/,replace:e??"×"}),ds=e=>T({find:/\^2$/,replace:e??"²"}),us=e=>T({find:/\^3$/,replace:e??"³"}),cs=e=>T({find:/(?:^|\s)(1\/4)\s$/,replace:e??"¼"}),ps=e=>T({find:/(?:^|\s)(3\/4)\s$/,replace:e??"¾"}),hs=U.create({name:"typography",addOptions(){return{closeDoubleQuote:"”",closeSingleQuote:"’",copyright:"©",ellipsis:"…",emDash:"—",laquo:"«",leftArrow:"←",multiplication:"×",notEqual:"≠",oneHalf:"½",oneQuarter:"¼",openDoubleQuote:"“",openSingleQuote:"‘",plusMinus:"±",raquo:"»",registeredTrademark:"®",rightArrow:"→",servicemark:"℠",superscriptThree:"³",superscriptTwo:"²",threeQuarters:"¾",trademark:"™"}},addInputRules(){const e=[];return this.options.emDash!==!1&&e.push(qn(this.options.emDash)),this.options.ellipsis!==!1&&e.push(Qn(this.options.ellipsis)),this.options.openDoubleQuote!==!1&&e.push(Wn(this.options.openDoubleQuote)),this.options.closeDoubleQuote!==!1&&e.push(zn(this.options.closeDoubleQuote)),this.options.openSingleQuote!==!1&&e.push(Yn(this.options.openSingleQuote)),this.options.closeSingleQuote!==!1&&e.push(Gn(this.options.closeSingleQuote)),this.options.leftArrow!==!1&&e.push(Jn(this.options.leftArrow)),this.options.rightArrow!==!1&&e.push(Xn(this.options.rightArrow)),this.options.copyright!==!1&&e.push(Zn(this.options.copyright)),this.options.trademark!==!1&&e.push(es(this.options.trademark)),this.options.servicemark!==!1&&e.push(ts(this.options.servicemark)),this.options.registeredTrademark!==!1&&e.push(ns(this.options.registeredTrademark)),this.options.oneHalf!==!1&&e.push(ss(this.options.oneHalf)),this.options.plusMinus!==!1&&e.push(rs(this.options.plusMinus)),this.options.notEqual!==!1&&e.push(is(this.options.notEqual)),this.options.laquo!==!1&&e.push(os(this.options.laquo)),this.options.raquo!==!1&&e.push(as(this.options.raquo)),this.options.multiplication!==!1&&e.push(ls(this.options.multiplication)),this.options.superscriptTwo!==!1&&e.push(ds(this.options.superscriptTwo)),this.options.superscriptThree!==!1&&e.push(us(this.options.superscriptThree)),this.options.oneQuarter!==!1&&e.push(cs(this.options.oneQuarter)),this.options.threeQuarters!==!1&&e.push(ps(this.options.threeQuarters)),e}}),fs=C.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["u",g(this.options.HTMLAttributes,e),0]},addCommands(){return{setUnderline:()=>({commands:e})=>e.setMark(this.name),toggleUnderline:()=>({commands:e})=>e.toggleMark(this.name),unsetUnderline:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function ms(e){const{noteId:t,content:n,editable:r,onUpdate:s}=e,i=_e({extensions:[$t,Vt,qt,zt,Jt,Xt.extend({content:"heading block*"}),tn,un,cn,pn,An,vn,Ln,Cn,Hn,On,Pn,Rn.configure({placeholder:o=>o.node.type.name==="heading"?o.node.attrs.level===1?"Untitled":"Heading":"Write something...",showOnlyWhenEditable:!1}),$n,Fn,Bn,Kn,Vn.configure({types:["heading","paragraph"]}),Un,hs,fs],content:n,editable:r,onUpdate:s},[t]);return M.useEffect(()=>{i&&i.setEditable(r)},[r]),i}const gs=e=>{var h,c;const{id:t,json:n,isEditable:r,isDeleted:s}=e,i=rt(),o=O(i.isError);j({note:i.data,isEnabled:i.isSuccess}),P({parentId:(h=i.data)==null?void 0:h.parentId,isEnabled:i.isSuccess});const a=tt(l=>{i.mutate({json:l,id:t})},1e3),d=I(l=>{const f=l.editor.getJSON(),m=JSON.stringify(f);a(m)}),u=ms({noteId:t,content:JSON.parse(n),editable:r&&!s,onUpdate:d});return p.jsxs(M.Fragment,{children:[u&&p.jsxs($e,{children:[p.jsx(De,{editor:u,visible:r&&!s}),p.jsx(Fe,{editor:u})]}),p.jsx(R,{title:"Something went wrong",text:((c=i.error)==null?void 0:c.message)??"",opened:o.isVisible,onClose:o.hide})]})},ys=M.memo(gs),bs=()=>{const e=Be(),t=Ke(),n=At({id:t.noteId});return M.useEffect(()=>{n.isError&&e(-1)},[n.isError]),p.jsxs(M.Fragment,{children:[p.jsx(Ve,{visible:n.isLoading,description:"Loading note"}),p.jsxs(Ue,{children:[p.jsx(qe,{children:n.data&&p.jsx(jt,{...n.data})}),p.jsx(Qe,{children:n.data&&p.jsx(ys,{...n.data})}),p.jsx(We,{children:p.jsx(ze,{})})]})]})},ks=bs;export{ks as NotePage};
